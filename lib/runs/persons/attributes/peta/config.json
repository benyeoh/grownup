[
    {
        "datasets": {
            "ktf.datasets.process_chain": {
                "input": {
                    "ktf.datasets.join": {
                        "dataset_tuples": [
                            {
                                "ktf.datasets.persons.peta.from_tfrecord": {
                                    "peta_tfrecord_dir": "/hpc-datasets/person_retrieval/dataset/peta/tfrecord/trainval",
                                    "validation_split": 0,
                                    "repeat": true,
                                    "batch_size": 128,
                                    "return_names": false,
                                    "shuffle_size": 5700,
                                    "convert_to_float": false
                                }
                            },
                            {
                                "ktf.datasets.persons.peta.from_tfrecord": {
                                    "peta_tfrecord_dir": "/hpc-datasets/person_retrieval/dataset/peta/tfrecord/test",
                                    "validation_split": 0,
                                    "repeat": true,
                                    "batch_size": 16,
                                    "return_names": false,
                                    "convert_to_float": false
                                }
                            }
                        ]
                    }
                },
                "0": [
                    {
                        "ktf.datasets.process.ImgAugmentation": {
                            "horizontal_flip_prob": 1,
                            "random_crop_prob": 0,
                            "central_crop_prob": 0,
                            "standardize_prob": 0
                        }
                    }
                ],
                ":": [
                    {
                        "ktf.datasets.process.MapInput": {
                            "map_fn": "tf.cast",
                            "dtype": "${tf.float32}"
                        }
                    },
                    {
                        "ktf.datasets.process.MapInput": {
                            "map_fn": "tf.keras.applications.resnet_v2.preprocess_input"
                        }
                    }
                ]
            }
        },
        "model": {
            "ktf.models.OneHeadNet": {
                "dropout": 0.5,
                "base_model": {
                    "tf.keras.applications.resnet_v2.ResNet50V2": {
                        "include_top": false,
                        "weights": null,
                        "pooling": "avg"
                    }
                },
                "num_outputs": 35,
                "initializer": {
                    " tf.keras.initializers.RandomNormal": {
                        "stddev": 0.001
                    }
                }
            }
        },
        "loss": {
            "ktf.models.losses.MultiClassBinaryCrossentropyBW": {
                "from_logits": true,
                "class_weights": [
                    0.492280701754386,
                    0.333859649122807,
                    0.10219298245614035,
                    0.06236842105263158,
                    0.19631578947368422,
                    0.19807017543859648,
                    0.8605263157894737,
                    0.8519298245614035,
                    0.1376315789473684,
                    0.13491228070175437,
                    0.10570175438596491,
                    0.06842105263157895,
                    0.30701754385964913,
                    0.2993859649122807,
                    0.04096491228070175,
                    0.23763157894736842,
                    0.5503508771929825,
                    0.29333333333333333,
                    0.0843859649122807,
                    0.7452631578947368,
                    0.27649122807017545,
                    0.026491228070175437,
                    0.07614035087719298,
                    0.021403508771929824,
                    0.36210526315789476,
                    0.035,
                    0.14078947368421052,
                    0.045,
                    0.2132456140350877,
                    0.017543859649122806,
                    0.029298245614035087,
                    0.5121052631578947,
                    0.08421052631578947,
                    0.45614035087719296,
                    0.01263157894736842
                ]
            }
        },
        "metrics": "${[ktf.models.metrics.MultiClassMeanAccuracy(num_classes=35) if x<0 else ktf.models.metrics.MultiClassSingleMeanAccuracy(x) for x in range(-1, 35)]}",
        "optimizer": {
            "tfa.optimizers.SGDW": {
                "weight_decay": 0.0001,
                "learning_rate": 0.001,
                "momentum": 0.9
            }
        },
        "train_loop": {
            "ktf.train.KerasTrainLoop": {
                "callbacks": [
                    {
                        "tf.keras.callbacks.CSVLogger": {
                            "filename": "/hpc-datasets/person_retrieval/weights/ktf/peta/deepmar_peta_resnet50v2.csv"
                        }
                    },
                    {
                        "tf.keras.callbacks.LearningRateScheduler": {
                            "verbose": 1,
                            "schedule": {
                                "ktf.train.callbacks.StepDecayScheduler": {
                                    "decay": 0.1,
                                    "decay_steps": 50
                                }
                            }
                        }
                    },
                    {
                        "tf.keras.callbacks.ModelCheckpoint": {
                            "filepath": "/hpc-datasets/person_retrieval/weights/ktf/peta/deepmar_peta_resnet50v2.tf",
                            "monitor": "val_mA",
                            "save_best_only": true,
                            "mode": "max",
                            "verbose": 1
                        }
                    }
                ],
                "num_epochs": 150,
                "num_steps": 90,
                "num_valid_steps": 475,
                "pretrained_weights": [
                    [
                        "resnet50v2",
                        "/hpc-datasets/ktf/weights/keras_apps/resnet50v2/resnet50v2_weights_tf_dim_ordering_tf_kernels_notop.h5"
                    ]
                ],
                "save_dir": "/tmp/ktf/deepmar_peta_author_config_wd_1e-4"
            }
        }
    }
]
